<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <title>Player API Tester (localhost:5000)</title>
    <style>
      body {
        font-family:
          system-ui,
          -apple-system,
          Segoe UI,
          Roboto,
          sans-serif;
        margin: 24px;
      }
      .row {
        display: flex;
        gap: 12px;
        flex-wrap: wrap;
      }
      .card {
        border: 1px solid #ddd;
        border-radius: 10px;
        padding: 16px;
        max-width: 980px;
      }
      label {
        display: block;
        font-size: 12px;
        color: #444;
        margin-bottom: 6px;
      }
      input,
      select {
        width: 340px;
        max-width: 100%;
        padding: 10px;
        border: 1px solid #ccc;
        border-radius: 8px;
      }
      button {
        padding: 10px 14px;
        border: 1px solid #ccc;
        border-radius: 8px;
        background: #fff;
        cursor: pointer;
      }
      button.primary {
        border-color: #111;
      }
      button:disabled {
        opacity: 0.6;
        cursor: not-allowed;
      }
      .muted {
        color: #666;
        font-size: 12px;
      }
      pre {
        white-space: pre-wrap;
        word-break: break-word;
        background: #0b1020;
        color: #e8e8e8;
        padding: 12px;
        border-radius: 10px;
        overflow: auto;
        min-height: 220px;
      }
      .pill {
        display: inline-block;
        padding: 2px 8px;
        border-radius: 999px;
        font-size: 12px;
        border: 1px solid #ddd;
      }
      .pill.ok {
        border-color: #0a7;
        color: #0a7;
      }
      .pill.err {
        border-color: #c33;
        color: #c33;
      }
      .grid {
        display: grid;
        grid-template-columns: 1fr 1fr;
        gap: 12px;
      }
      @media (max-width: 980px) {
        .grid {
          grid-template-columns: 1fr;
        }
      }
      code {
        background: #f4f4f4;
        padding: 1px 6px;
        border-radius: 6px;
      }
    </style>
  </head>
  <body>
    <h1>Player API Tester</h1>
    <p class="muted">
      Targets <code>http://localhost:5000</code> by default. If you open this
      via <code>file://</code> and hit CORS issues, serve it with any static
      server (or enable CORS on your Express app).
    </p>

    <div class="card">
      <div class="row">
        <div>
          <label for="baseUrl">Base URL</label>
          <input id="baseUrl" value="http://localhost:5000" />
          <div class="muted">Player base path: <code>/api/players</code></div>
        </div>

        <div>
          <label for="playerId">Player ID (Discord ID or UUID)</label>
          <input
            id="playerId"
            placeholder="123456789012345678 or 550e8400-..."
          />
          <div class="muted">Discord ID (17-20 digits) or Minecraft UUID</div>
        </div>

        <div>
          <label for="searchUsername">Search Username</label>
          <input id="searchUsername" placeholder="steve" />
          <div class="muted">Partial match, case-insensitive</div>
        </div>

        <div>
          <label for="page">Page (0-indexed)</label>
          <input id="page" value="0" inputmode="numeric" />
        </div>

        <div>
          <label for="limit">Limit (1-100)</label>
          <input id="limit" value="20" inputmode="numeric" />
        </div>

        <div>
          <label for="sortBy">Sort By</label>
          <select id="sortBy">
            <option value="createdAt">Created At</option>
            <option value="minecraftUsername">Username</option>
            <option value="updatedAt">Updated At</option>
          </select>
        </div>

        <div>
          <label for="sortOrder">Sort Order</label>
          <select id="sortOrder">
            <option value="desc">Descending</option>
            <option value="asc">Ascending</option>
          </select>
        </div>

        <div>
          <label for="isActive">Active Status</label>
          <select id="isActive">
            <option value="">All</option>
            <option value="true">Active Only</option>
            <option value="false">Inactive Only</option>
          </select>
        </div>
      </div>

      <div style="height: 12px"></div>

      <div class="row">
        <button class="primary" id="getByIdBtn">GET /api/players/:id</button>
        <button id="getAllBtn">GET /api/players (All)</button>
        <button id="searchBtn">GET /api/players (Search)</button>
        <button id="testDiscordBtn">Test Discord ID</button>
        <button id="testUuidBtn">Test UUID</button>
        <button id="clearBtn">Clear Output</button>
      </div>

      <div style="height: 12px"></div>

      <div class="grid">
        <div>
          <div
            class="row"
            style="align-items: center; justify-content: space-between"
          >
            <strong>Response</strong>
            <span id="statusPill" class="pill">idle</span>
          </div>
          <pre id="output">{}</pre>
        </div>

        <div>
          <strong>Notes</strong>
          <ul class="muted">
            <li>
              <strong>Get by ID</strong>: Accepts Discord ID (17-20 digits) or
              Minecraft UUID
            </li>
            <li>
              <strong>Get All</strong>: Returns paginated list with sorting
            </li>
            <li>
              <strong>Search</strong>: Filters by username (partial match)
            </li>
            <li>All routes are PUBLIC (AuthLevel.PUBLIC)</li>
            <li>
              Dates in responses are ISO strings (e.g.
              "2024-01-01T00:00:00.000Z")
            </li>
            <li>
              Response includes <code>PlayerApiData</code> with Date fields as
              strings
            </li>
            <li>
              Pagination includes: <code>page</code>, <code>limit</code>,
              <code>total</code>, <code>totalPages</code>
            </li>
          </ul>
        </div>
      </div>
    </div>

    <script>
      const els = {
        baseUrl: document.getElementById("baseUrl"),
        playerId: document.getElementById("playerId"),
        searchUsername: document.getElementById("searchUsername"),
        page: document.getElementById("page"),
        limit: document.getElementById("limit"),
        sortBy: document.getElementById("sortBy"),
        sortOrder: document.getElementById("sortOrder"),
        isActive: document.getElementById("isActive"),

        getByIdBtn: document.getElementById("getByIdBtn"),
        getAllBtn: document.getElementById("getAllBtn"),
        searchBtn: document.getElementById("searchBtn"),
        testDiscordBtn: document.getElementById("testDiscordBtn"),
        testUuidBtn: document.getElementById("testUuidBtn"),
        clearBtn: document.getElementById("clearBtn"),

        output: document.getElementById("output"),
        statusPill: document.getElementById("statusPill"),
      };

      function setStatus(ok, text) {
        els.statusPill.classList.remove("ok", "err");
        if (ok === true) els.statusPill.classList.add("ok");
        if (ok === false) els.statusPill.classList.add("err");
        els.statusPill.textContent = text;
      }

      function pretty(obj) {
        try {
          return JSON.stringify(obj, null, 2);
        } catch {
          return String(obj);
        }
      }

      function base() {
        return (els.baseUrl.value || "http://localhost:5000").replace(
          /\/+$/,
          "",
        );
      }

      function headers() {
        return { "Content-Type": "application/json" };
      }

      function setBusy(b) {
        els.getByIdBtn.disabled = b;
        els.getAllBtn.disabled = b;
        els.searchBtn.disabled = b;
        els.testDiscordBtn.disabled = b;
        els.testUuidBtn.disabled = b;
      }

      async function request(method, path) {
        const url = base() + path;
        const init = { method, headers: headers() };

        const startedAt = performance.now();
        let res, raw;

        setStatus(null, "sending...");
        try {
          res = await fetch(url, init);
          raw = await res.text();
        } catch (e) {
          setStatus(false, "network error");
          els.output.textContent =
            "Network error (likely CORS or server down).\n\n" + String(e);
          throw e;
        }

        const ms = Math.round(performance.now() - startedAt);

        let parsed;
        try {
          parsed = raw ? JSON.parse(raw) : null;
        } catch {
          parsed = raw;
        }

        setStatus(res.ok, `${res.status} ${res.statusText} â€¢ ${ms}ms`);

        els.output.textContent = pretty({
          request: {
            method,
            url,
            headers: Object.keys(headers()),
          },
          response: {
            status: res.status,
            statusText: res.statusText,
            ok: res.ok,
            body: parsed,
          },
        });

        return { res, parsed };
      }

      els.clearBtn.addEventListener("click", () => {
        els.output.textContent = "{}";
        setStatus(null, "idle");
      });

      els.getByIdBtn.addEventListener("click", async () => {
        const id = (els.playerId.value || "").trim();
        if (!id) {
          setStatus(false, "missing id");
          els.output.textContent = pretty({
            error: "Please enter a Player ID (Discord ID or UUID).",
          });
          return;
        }
        setBusy(true);
        try {
          await request("GET", `/api/players/${encodeURIComponent(id)}`);
        } finally {
          setBusy(false);
        }
      });

      els.getAllBtn.addEventListener("click", async () => {
        const params = new URLSearchParams();

        const page = parseInt(els.page.value || "0");
        const limit = parseInt(els.limit.value || "20");
        const sortBy = els.sortBy.value || "createdAt";
        const sortOrder = els.sortOrder.value || "desc";
        const isActive = els.isActive.value;

        params.append("page", page.toString());
        params.append("limit", limit.toString());
        params.append("sort_by", sortBy);
        params.append("sort_order", sortOrder);

        if (isActive) {
          params.append("is_active", isActive);
        }

        setBusy(true);
        try {
          await request("GET", `/api/players?${params.toString()}`);
        } finally {
          setBusy(false);
        }
      });

      els.searchBtn.addEventListener("click", async () => {
        const username = (els.searchUsername.value || "").trim();
        if (!username) {
          setStatus(false, "missing username");
          els.output.textContent = pretty({
            error: "Please enter a username to search.",
          });
          return;
        }

        const params = new URLSearchParams();
        params.append("minecraft_username", username);

        const limit = parseInt(els.limit.value || "20");
        params.append("limit", limit.toString());

        const sortBy = els.sortBy.value || "createdAt";
        const sortOrder = els.sortOrder.value || "desc";
        params.append("sort_by", sortBy);
        params.append("sort_order", sortOrder);

        const isActive = els.isActive.value;
        if (isActive) {
          params.append("is_active", isActive);
        }

        setBusy(true);
        try {
          await request("GET", `/api/players?${params.toString()}`);
        } finally {
          setBusy(false);
        }
      });

      els.testDiscordBtn.addEventListener("click", async () => {
        const testId = "123456789012345678";
        setBusy(true);
        try {
          await request("GET", `/api/players/${testId}`);
        } finally {
          setBusy(false);
        }
      });

      els.testUuidBtn.addEventListener("click", async () => {
        const testUuid = "550e8400-e29b-41d4-a716-446655440000";
        setBusy(true);
        try {
          await request("GET", `/api/players/${testUuid}`);
        } finally {
          setBusy(false);
        }
      });
    </script>
  </body>
</html>
